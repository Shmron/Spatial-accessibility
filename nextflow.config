/*
 * Nextflow Configuration for Spatial Access Workflow
 */

// Manifest information
manifest {
    name = 'spatial-access-workflow'
    author = 'Workshop Participant'
    description = 'Spatial accessibility analysis using OSM routing and hexagonal grids'
    version = '1.0.0'
    nextflowVersion = '>=23.0.0'
}

// Default parameters
params {
    // Input files
    osm_pbf = null
    districts_shp = null
    facilities_csv = null
    population_tif = null

    // Analysis parameters
    facility_type = 'school'
    hex_resolution = 8

    // OSRM settings
    osrm_host = 'localhost'
    osrm_port = 5000

    // Output
    outdir = 'results'

    // Help
    help = false
}

// Process configuration
process {
    // Error handling
    errorStrategy = 'retry'
    maxRetries = 2

    // Resource defaults
    cpus = 1
    memory = '4 GB'
    time = '2h'

    // Container settings
    withName: 'setupOSRM' {
        container = 'osrm/osrm-backend:latest'
        cpus = 2
        memory = '8 GB'
    }

    withName: 'splitDistricts|generateGrids|extractPopulation|filterFacilities|calculateAccessibility|computeMetrics|createVisualization|aggregateSummary' {
        container = 'spatial-analysis:latest'
    }

    withName: 'calculateAccessibility' {
        memory = '8 GB'
        time = '4h'
    }
}

// Executor configuration
executor {
    name = 'local'
    cpus = 4
    memory = '16 GB'
}

// Docker configuration
docker {
    enabled = true
    runOptions = '-u $(id -u):$(id -g)'
}

// Singularity configuration (alternative to Docker)
singularity {
    enabled = false
    autoMounts = true
}

// Report configuration
report {
    enabled = true
    file = "${params.outdir}/report.html"
}

timeline {
    enabled = true
    file = "${params.outdir}/timeline.html"
}

trace {
    enabled = true
    file = "${params.outdir}/trace.txt"
}

// Profiles for different environments
profiles {
    standard {
        docker.enabled = true
    }

    singularity {
        docker.enabled = false
        singularity.enabled = true
    }

    cluster {
        process.executor = 'slurm'
        process.queue = 'normal'
    }

    test {
        params.hex_resolution = 6  // Larger hexagons for faster testing
        process.memory = '2 GB'
    }
}